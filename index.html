<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>אתר הסרטונים של אשר לוי - זיכרונות משפחה</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* CSS styles as provided by the user, with minor additions for new elements */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: auto;
            background-position: left bottom, right bottom;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 15px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .admin-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .grandpa-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin: 20px auto;
            display: block;
            object-fit: cover;
        }

        .gift-note {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
            border: 2px solid #ffd700;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .gift-note:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
        }

        .youtube-section {
            margin-bottom: 40px;
        }

        .youtube-link {
            display: block;
            background: linear-gradient(45deg, #ff0000, #cc0000);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-decoration: none;
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .youtube-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 0, 0, 0.3);
        }

        .category-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            justify-content: center;
        }

        .category-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .category-btn:hover, .category-btn.active {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            background: linear-gradient(45deg, #764ba2, #667eea);
        }

        .category-section {
            margin-bottom: 50px;
        }

        .category-title {
            font-size: 2rem;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            border-radius: 10px;
            text-align: center;
            color: #333;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .video-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .video-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            display: block;
        }

        .video-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .video-description {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .video-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-youtube {
            background: linear-gradient(45deg, #ff0000, #cc0000);
        }

        .btn-tiktok {
            background: linear-gradient(45deg, #000000, #333333);
        }

        .delete-btn, .edit-btn {
            position: absolute;
            top: 10px;
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .delete-btn {
            left: 10px;
            background: #ff4757;
            color: white;
        }

        .edit-btn {
            right: 10px;
            background: #2ecc71;
            color: white;
        }

        .delete-btn:hover {
            background: #ff3742;
            transform: scale(1.1);
        }

        .edit-btn:hover {
            background: #27ae60;
            transform: scale(1.1);
        }

        .admin-mode .delete-btn,
        .admin-mode .edit-btn {
            display: flex;
        }

        .category-icon {
            font-size: 1.5rem;
            margin-left: 10px;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            border-radius: 15px;
            color: #333;
        }

        .hearts {
            font-size: 1.5rem;
            margin: 10px 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .hidden {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        .modal h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .send-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            width: 100%;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .admin-panel {
            background: linear-gradient(45deg, #ff9f43, #feca57);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .admin-controls button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .admin-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .add-video-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .add-video-form.active {
            display: block;
        }

        .background-settings-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .background-settings-form.active {
            display: block;
        }

        .background-settings-form .form-group.radio-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            align-items: center;
        }

        .background-settings-form .form-group.radio-group label {
            margin-bottom: 0;
            display: inline-block;
        }

        .background-settings-form .form-group.radio-group input[type="radio"] {
            width: auto;
            margin-left: 5px;
        }

        .background-settings-form input[type="number"] {
            width: auto;
            padding: 8px;
        }

        /* New: Cropper.js modal styles */
        .crop-modal-content {
            padding: 20px;
        }

        .img-container {
            width: 100%;
            max-height: 400px;
            overflow: hidden;
            background: #f7f7f7;
            margin-bottom: 20px;
            direction: ltr; /* Cropper.js works better in LTR */
        }

        .img-container img {
            max-width: 100%;
            display: block;
        }

        .crop-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .crop-controls button {
            background: linear-gradient(45deg, #28a745, #218838);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .crop-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .crop-controls .cancel-btn {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .crop-controls .cancel-btn:hover {
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .video-gallery {
                grid-template-columns: 1fr;
            }

            .category-filters {
                justify-content: center;
            }

            .category-btn {
                font-size: 0.9rem;
                padding: 10px 15px;
            }

            .grandpa-photo {
                width: 120px;
                height: 120px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }
        }

        .social-icons {
            position: absolute;
            top: 50%; /* Center vertically */
            transform: translateY(-50%); /* Precisely center */
            width: 100%;
            display: flex;
            justify-content: space-between; /* Distribute between edges */
            padding: 0 40px; /* Margin from edges */
            z-index: 2;
            pointer-events: none; /* Prevents issues with clicks */
        }

        .social-icons a {
            pointer-events: auto; /* Allow clicks only on icons */
            color: white; /* White color for icons on colored background */
            font-size: 100px; /* Icon size */
            transition: transform 0.3s ease, color 0.3s ease;
            text-decoration: none;
            display: flex;
            flex-direction: column; /* Arrange icon and text one below the other */
            align-items: center;
            justify-content: center;
            gap: 8px; /* Space between icon and text */
        }

        .social-icons a:hover {
            transform: translateY(-3px) scale(1.1); /* Hover effect */
        }

        .social-icons a .social-text {
            font-size: 12px;
            text-align: center;
            line-height: 1.2;
            max-width: 120px; /* Changed from 80px to 120px */
            word-wrap: break-word; /* Added this line */
            font-family: Arial, sans-serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* Specific colors for icons on hover */
        .social-icons .fa-instagram:hover {
            color: #E1306C; /* Original Instagram color */
        }

        .social-icons .fa-tiktok:hover {
            color: #000; /* Original TikTok color (black) */
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5); /* Light white shadow for TikTok */
        }

        /* Responsive adjustments for icons */
        @media (max-width: 768px) {
            .social-icons {
                position: static; /* Remove absolute positioning on mobile */
                transform: none;
                width: auto;
                justify-content: center;
                padding: 10px;
                gap: 20px;
            }

            .social-icons a {
                font-size: 28px;
            }
        }

        /* New: Dropdown menu style */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            min-width: 220px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-radius: 15px;
            z-index: 1000;
            border: 2px solid #667eea;
            overflow: hidden;
            margin-top: 5px;
        }

        .dropdown-content a {
            color: #333;
            padding: 15px 20px;
            text-decoration: none;
            display: block;
            transition: all 0.3s ease;
            font-weight: bold;
            border-bottom: 1px solid #f0f0f0;
            background: white;
        }

        .dropdown-content a:last-child {
            border-bottom: none;
        }

        .dropdown-content a:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateX(5px);
        }

        .dropdown.show .dropdown-content {
            display: block;
            animation: dropdownFadeIn 0.3s ease;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Special style for the trips button when dropdown is open */
        .dropdown.show .trips-btn {
            background: linear-gradient(45deg, #764ba2, #667eea);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        /* Small arrow to indicate dropdown */
        .trips-btn::after {
            content: " ▼";
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }

        .dropdown.show .trips-btn::after {
            transform: rotate(180deg);
        }

        /* Responsive adjustment */
        @media (max-width: 768px) {
            .dropdown-content {
                min-width: 200px;
                left: 0;
                transform: none;
                margin-top: 5px;
            }
            .category-delete-btn {
                background: none;
                border: none;
                color: #ff4757;
                cursor: pointer;
                padding: 4px 8px;
                font-size: 0.9em;
                opacity: 0.7;
                transition: all 0.3s ease;
                border-radius: 50%;
                margin-right: 8px;
                display: none;
            }

            .admin-mode .category-delete-btn {
                display: inline-block;
            }

            .category-delete-btn:hover {
                opacity: 1;
                background: rgba(255, 71, 87, 0.1);
            }

            .category-btn-wrapper {
                position: relative;
                display: inline-flex;
                align-items: center;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <button class="admin-btn" onclick="showAdminLogin()">מנהל </button>
            <div class="social-icons">
                <a href="https://www.instagram.com/asher_levy_1955?igsh=c2pxZXV6ZjIycnUx" target="_blank" aria-label="Instagram">
                    <i class="fab fa-instagram"></i>
                    <span class="social-text">לעמוד האינסטגרם</span>
                </a>
                <a href="https://www.tiktok.com/@frw5yfrw5y?_t=ZS-8wp8xDgd6EC&_r=1" target="_blank" aria-label="TikTok">
                    <i class="fab fa-tiktok"></i>
                    <span class="social-text">לעמוד הטיקטוק</span>
                </a>
            </div>
            <h1> אתר הסרטונים של אשר לוי </h1>
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z0I+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiByeD0iNzUiIGZpbGw9IiNmZjZiNmIiLz4KPHN2ZyB4PSIzNSIgeT0iMzAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCA0IDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzEzLjEgMiAxNCAyLjkgMTQgNFYxMEgxNkMxNi42IDEwIDE3IDEwLjQgMTcgMTFWMTJIMjBDMjAuNiAxMiAyMSAxMi40IDIxIDEzVjE5QzIxIDE5LjYgMjAuNiAyMCAyMCAyMEgxM1YyMkg4VjIwSDRWMzRDMyAzLjQgMyAzIDE5LjYgMyAxOVYxM0Mz thyme:3 12.N4 3.N4 12 4 12H7V11F7 7.N4 7.N4 10 8 10H10F4Q10 2.N9 10.N9 2 12 2ZM4 20H13L13 22V20L20 20V13H21L12 12H10.N9V4V10V4H3V20ZCIvPgo8L3N2Zz4KPHRleHQgeD0iNzUiIHk9IjEzMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QnJldmFsPC90ZXh0Pgo8L3N2Zz4=" alt="סבא אשר לוי" class="grandpa-photo">
            <p>זיכרונות יקרים מרגעים מאושרים</p>
        </div>

        <div class="admin-panel" id="adminPanel">
            <h3> פאנל מנהל</h3>
            <div class="admin-controls">
                <button onclick="toggleAddVideoForm()">➕ הוסף סרטון</button>
                <button onclick="toggleDeleteMode()">️ מצב מחיקה</button>
                <button onclick="exitAdmin()"> יציאה</button>
                <input type="file" id="profileImageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event, 'profile')">
                <button onclick="document.getElementById('profileImageUpload').click()"> שנה תמונת פרופיל</button>
                <button onclick="toggleBackgroundSettingsForm()">️ תמונות רקע</button>
                <button onclick="openManageCategoriesModal()">️ ניהול קטגוריות</button>
            </div>

            <div class="add-video-form" id="addVideoForm">
                <h4>הוסף סרטון חדש</h4>
                <form onsubmit="addNewVideo(event)">
                    <div class="form-group">
                        <label for="videoTitle">כותרת הסרטון:</label>
                        <input type="text" id="videoTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="videoDescription">תיאור הסרטון:</label>
                        <textarea id="videoDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="youtubeLink">קישור ליוטיוב (אופציונלי):</label>
                        <input type="url" id="youtubeLink" placeholder="https://www.youtube.com/watch?v=VIDEO_ID">
                    </div>
                    <div class="form-group">
                        <label for="tiktokLink">קישור לטיקטוק (אופציונלי):</label>
                        <input type="url" id="tiktokLink" placeholder="https://www.tiktok.com/@username/video/VIDEO_ID">
                    </div>
                    <div class="form-group">
                        <label for="thumbnailUrl">קישור לתמונה ממוזערת (אופציונלי):</label>
                        <input type="url" id="thumbnailUrl" placeholder="https://example.com/thumbnail.jpg">
                    </div>
                    <div class="form-group">
                        <label for="videoCategory">קטגוריה:</label>
                        <select id="videoCategory" required>
                            <!-- Categories will be populated here by JavaScript -->
                        </select>
                    </div>
                    <input type="hidden" id="videoId">
                    <button type="submit" class="send-btn" id="addEditVideoBtn">הוסף סרטון</button>
                </form>
            </div>

            <div class="background-settings-form" id="backgroundSettingsForm">
                <h4>הגדרות רקע</h4>
                <div class="form-group">
                    <label for="backgroundUrl">קישור לתמונת רקע:</label>
                    <input type="url" id="backgroundUrl" placeholder="השאר ריק לבחירת צבע">
                </div>
                <input type="file" id="backgroundImageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event, 'background')">
                <button class="send-btn" onclick="document.getElementById('backgroundImageUpload').click()">העלה תמונת רקע</button>
                <div class="form-group">
                    <label for="backgroundColor">צבע רקע (אם אין תמונה):</label>
                    <input type="color" id="backgroundColor" value="#667eea">
                </div>
                <div class="form-group">
                    <label for="backgroundOpacity">שקיפות תמונה (0-1):</label>
                    <input type="number" id="backgroundOpacity" min="0" max="1" step="0.1" value="1">
                </div>
                <div class="form-group">
                    <label for="backgroundBlur">טשטוש רקע (פיקסלים):</label>
                    <input type="number" id="backgroundBlur" min="0" max="20" step="1" value="0">
                </div>
                <div class="form-group radio-group">
                    <label>גודל תמונה:</label>
                    <input type="radio" id="bgSizeCover" name="backgroundSize" value="cover"> <label for="bgSizeCover">כיסוי</label>
                    <input type="radio" id="bgSizeContain" name="backgroundSize" value="contain"> <label for="bgSizeContain">הכלה</label>
                    <input type="radio" id="bgSizeAuto" name="backgroundSize" value="auto" checked> <label for="bgSizeAuto">אוטומטי</label>
                </div>
                <div class="form-group radio-group">
                    <label>מיקום תמונה:</label>
                    <input type="radio" id="bgPositionCenter" name="backgroundPosition" value="center" checked> <label for="bgPositionCenter">מרכז</label>
                    <input type="radio" id="bgPositionTop" name="backgroundPosition" value="top"> <label for="bgPositionTop">למעלה</label>
                    <input type="radio" id="bgPositionBottom" name="backgroundPosition" value="bottom"> <label for="bgPositionBottom">למטה</label>
                </div>
                <button type="button" class="send-btn" onclick="applyBackgroundSettings()">שמור הגדרות רקע</button>
            </div>
        </div>

        <div class="gift-note" id="giftNote">
            <p> מתנה מאיתנו, המשפחה האוהבת </p>
        </div>

        <div class="youtube-section">
            <a href="https://www.youtube.com/@asherlevy9138" target="_blank" class="youtube-link">
                <i class="fab fa-youtube"></i> לערוץ היוטיוב של אשר לוי
            </a>
        </div>

        <div class="category-filters" id="categoryFilters">
            <!-- Category buttons will be rendered here -->
        </div>

        <div id="videoCategoriesContainer">
            <!-- Video categories and galleries will be rendered here -->
        </div>

        <div class="footer">
            <p class="hearts">❤️❤️❤️</p>
            <p>נוצר באהבה על ידי המשפחה</p>
            <p>© 2024 כל הזכויות שמורות</p>
        </div>
    </div>

    <!-- Modals -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('adminLoginModal')">&times;</span>
            <h2>התחברות מנהל</h2>
            <div class="form-group">
                <label for="adminPassword">סיסמה:</label>
                <input type="password" id="adminPassword">
            </div>
            <button class="send-btn" onclick="authenticateAdmin()">התחבר</button>
        </div>
    </div>

    <div id="cropImageModal" class="modal">
        <div class="modal-content crop-modal-content">
            <span class="close" onclick="closeModal('cropImageModal')">&times;</span>
            <h2>חיתוך תמונה</h2>
            <div class="img-container">
                <img id="imageToCrop" src="" alt="תמונה לחיתוך">
            </div>
            <div class="crop-controls">
                <button class="send-btn" onclick="cropAndSaveImage()">חתוך ושמור</button>
                <button class="send-btn cancel-btn" onclick="closeModal('cropImageModal')">ביטול</button>
            </div>
        </div>
    </div>

    <div id="manageCategoriesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('manageCategoriesModal')">&times;</span>
            <h2>ניהול קטגוריות</h2>
            <div class="form-group">
                <label for="newCategoryName">שם קטגוריה חדש:</label>
                <input type="text" id="newCategoryName">
            </div>
            <div class="form-group">
                <label for="newCategoryIcon">אייקון קטגוריה (Font Awesome class):</label>
                <input type="text" id="newCategoryIcon" placeholder="e.g., fas fa-camera">
            </div>
            <button class="send-btn" onclick="addCategory()">הוסף קטגוריה</button>
            <hr style="margin: 20px 0; border-color: #eee;">
            <h3>קטגוריות קיימות:</h3>
            <div id="existingCategoriesList">
                <!-- Existing categories will be listed here -->
            </div>
        </div>
    </div>

    <script>
        // =============================================================================
        // GitHub SYNC - הגדרות ראשוניות
        // =============================================================================

        // החלף את הפרטים האלה בשלך!
        const GITHUB_CONFIG = {
            owner: 'ronilemda',
            repo: 'Asher_web',
            token: 'YOUR_GITHUB_PERSONAL_ACCESS_TOKEN', // !!! יש להחליף בטוקן אמיתי עם הרשאות כתיבה (repo scope) !!!
            dataFile: 'data.json'
        };

        // =============================================================================
        // מנהל הסנכרון עם GitHub
        // =============================================================================

        class GitHubDataManager {
            constructor(config) {
                this.config = config;
                this.baseUrl = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.dataFile}`;
                this.headers = {
                    'Authorization': `token ${config.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                };
            }

            // קריאת נתונים מ-GitHub
            async loadData() {
                try {
                    const response = await fetch(this.baseUrl, {
                        method: 'GET',
                        headers: this.headers
                    });

                    if (response.status === 404) {
                        console.log('Data file not found on GitHub. Initializing with default data structure.');
                        // Return a default, empty data structure if the file doesn't exist
                        return {
                            videos: [],
                            profilePhoto: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z0I+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiByeD0iNzUiIGZpbGw9IiNmZjZiNmIiLz4KPHN2ZyB4PSIzNSIgeT0iMzAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCA0IDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzEzLjEgMiAxNCAyLjkgMTQgNFYxMEgxNkMxNi42IDEwIDE3IDEwLjQgMTcgMTFWMTJIMjBDMjAuNiAxMiAyMSAxMi40IDIxIDEzVjE5QzIxIDE5LjYgMjAuNiAyMCAyMCAyMEgxM1YyMkg4VjIwSDRWMzRDMyAzLjQgMyAzIDE5LjYgMyAxOVYxM0Mz thyme:3 12.N4 3.N4 12 4 12H7V11F7 7.N4 7.N4 10 8 10H10F4Q10 2.N9 10.N9 2 12 2ZM4 20H13L13 22V20L20 20V13H21L12 12H10.N9V4V10V4H3V20ZCIvPgo8L3N2Zz4KPHRleHQgeD0iNzUiIHk9IjEzMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QnJldmFsPC90ZXh0Pgo8L3N2Zz4=",
                            backgroundSettings: {
                                url: '',
                                color: '#667eea',
                                opacity: 1,
                                blur: 0,
                                size: 'auto',
                                position: 'center'
                            },
                            categories: [
                                { id: 'family', name: 'משפחה', icon: 'fas fa-home' },
                                { id: 'trips', name: 'טיולים', icon: 'fas fa-plane-departure', subcategories: [
                                    { id: 'trips-abroad', name: 'טיולים בחו"ל' },
                                    { id: 'trips-israel', name: 'טיולים בארץ' }
                                ]},
                                { id: 'events', name: 'אירועים', icon: 'fas fa-calendar-alt' },
                                { id: 'childhood', name: 'ילדות', icon: 'fas fa-child' }
                            ]
                        };
                    }

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const fileData = await response.json();
                    const content = atob(fileData.content);
                    return JSON.parse(content);
                } catch (error) {
                    console.error('שגיאה בטעינת נתונים מ-GitHub:', error);
                    // Fallback to initial default data structure on error
                    return {
                        videos: [],
                        profilePhoto: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z0I+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiByeD0iNzUiIGZpbGw9IiNmZjZiNmIiLz4KPHN2ZyB4PSIzNSIgeT0iMzAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCA0IDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzEzLjEgMiAxNCAyLjkgMTQgNFYxMEgxNkMxNjYgMTcgMTAuNCAxNyAxNTAuOCAxNCAyLjkgMTQgNFYxMEgxNkMxNi42IDEwIDE3IDEwLjQgMTcgMTFWMTJIMjBDMjAuNiAxMiAyMSAxMi40IDIxIDEzVjE5QzIxIDE5LjYgMjAuNiAyMCAyMCAyMEgxM1YyMkg4VjIwSDRWMzRDMyAzLjQgMyAzIDE5LjYgMyAxOVYxM0Mz thyme:3 12.N4 3.N4 12 4 12H7V11F7 7.N4 7.N4 10 8 10H10F4Q10 2.N9 10.N9 2 12 2ZM4 20H13L13 22V20L20 20V13H21L12 12H10.N9V4V10V4H3V20ZCIvPgo8L3N2Zz4KPHRleHQgeD0iNzUiIHk9IjEzMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QnJldmFsPC90ZXh0Pgo8L3N2Zz4=",
                            backgroundSettings: {
                                url: '',
                                color: '#667eea',
                                opacity: 1,
                                blur: 0,
                                size: 'auto',
                                position: 'center'
                            },
                            categories: [
                                { id: 'family', name: 'משפחה', icon: 'fas fa-home' },
                                { id: 'trips', name: 'טיולים', icon: 'fas fa-plane-departure', subcategories: [
                                    { id: 'trips-abroad', name: 'טיולים בחו"ל' },
                                    { id: 'trips-israel', name: 'טיולים בארץ' }
                                ]},
                                { id: 'events', name: 'אירועים', icon: 'fas fa-calendar-alt' },
                                { id: 'childhood', name: 'ילדות', icon: 'fas fa-child' }
                            ]
                        };
                    };
                }
            }

            // שמירת נתונים ל-GitHub
            async saveData(data) {
                if (!this.config.token || this.config.token === 'YOUR_GITHUB_PERSONAL_ACCESS_TOKEN') {
                    console.error('GitHub token is not set. Cannot save to GitHub.');
                    return false;
                }
                try {
                    let sha = null;
                    try {
                        const currentFile = await fetch(this.baseUrl, {
                            method: 'GET',
                            headers: this.headers
                        });
                        if (currentFile.ok) {
                            const fileData = await currentFile.json();
                            sha = fileData.sha;
                        }
                    } catch (e) {
                        // File might not exist, that's fine for initial commit
                        console.warn('Could not fetch current file SHA (might be new file):', e);
                    }

                    const content = btoa(JSON.stringify(data, null, 2));

                    const payload = {
                        message: `עדכון נתונים - ${new Date().toLocaleString('he-IL')}`,
                        content: content,
                        ...(sha && { sha })
                    };

                    const response = await fetch(this.baseUrl, {
                        method: 'PUT',
                        headers: this.headers,
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} - ${await response.text()}`);
                    }

                    console.log('✅ נתונים נשמרו בהצלחה ל-GitHub!');
                    return true;
                } catch (error) {
                    console.error('❌ שגיאה בשמירת נתונים ל-GitHub:', error);
                    return false;
                }
            }

            // סנכרון מ-GitHub ל-localStorage (כגיבוי מקומי ו-cache)
            async syncFromGitHub() {
                const data = await this.loadData();
                localStorage.setItem('asherAppData', JSON.stringify(data)); // Save entire data object to localStorage
                return data;
            }

            // סנכרון מ-localStorage ל-GitHub (שמירה של כל הנתונים)
            async syncToGitHub() {
                const data = JSON.parse(localStorage.getItem('asherAppData'));
                if (data) {
                    return await this.saveData(data);
                }
                return false;
            }
        }

        // יצירת מנהל הנתונים
        const dataManager = new GitHubDataManager(GITHUB_CONFIG);

        // =============================================================================
        // פונקציות עזר גלובליות
        // =============================================================================

        window.GitHubSync = {
            // טעינת נתונים בתחילה
            async init() {
                try {
                    console.log(' טוען נתונים מ-GitHub...');
                    // Clear localStorage if it's a fresh load (to prevent old local data conflicting)
                    const isFirstRun = !localStorage.getItem('asherAppDataInitialized');
                    if (isFirstRun) {
                        console.log('Performing first-time setup: Clearing old local storage data.');
                        localStorage.clear(); // Clear all old localStorage keys
                        localStorage.setItem('asherAppDataInitialized', 'true'); // Mark as initialized
                    }

                    const loadedData = await dataManager.syncFromGitHub();
                    Object.assign(appData, loadedData); // Update appData with loaded data
                    console.log('✅ נתונים נטענו בהצלחה!');

                    // Call functions to load data into the UI after sync
                    renderAllUI();

                } catch (error) {
                    console.error('❌ שגיאה בטעינת נתונים:', error);
                    this.showMessage('❌ שגיאה בטעינת נתונים. נסה לרענן.', 'error');
                }
            },

            // שמירה אוטומטית
            async autoSave() {
                try {
                    console.log(' שומר נתונים ל-GitHub...');
                    // First, save current appData to localStorage as a cache
                    localStorage.setItem('asherAppData', JSON.stringify(appData));
                    const success = await dataManager.syncToGitHub();

                    if (success) {
                        this.showMessage('✅ נתונים נשמרו בהצלחה ל-GitHub!', 'success');
                    } else {
                        this.showMessage('⚠️ נשמר מקומית בלבד. ודא שהטוקן של GitHub הוגדר נכון.', 'warning');
                    }
                } catch (error) {
                    console.error('❌ שגיאה בשמירה:', error);
                    this.showMessage('❌ שגיאה בשמירה', 'error');
                }
            },

            // הצגת הודעות
            showMessage(message, type) {
                const messageEl = document.createElement('div');
                messageEl.textContent = message;
                messageEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 10px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: bold;
                    z-index: 9999;
                    font-family: Arial, sans-serif;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    ${type === 'success' ? 'background: #4CAF50;' : ''}
                    ${type === 'warning' ? 'background: #FF9800;' : ''}
                    ${type === 'error' ? 'background: #F44336;' : ''}
                `;

                document.body.appendChild(messageEl);

                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, 3000);
            }
        };

        // =============================================================================
        // ניהול נתוני האפליקציה (במקום localStorage מפוצל)
        // =============================================================================

        // אובייקט גלובלי שיכיל את כל הנתונים של האפליקציה
        const appData = {
            videos: [],
            profilePhoto: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z0I+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiByeD0iNzUiIGZpbGw9IiNmZjZiNmIiLz4KPHN2ZyB4PSIzNSIgeT0iMzAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCA0IDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzEzLjEgMiAxNCAyLjkgMTQgNFYxMEgxNkMxNi42IDEwIDE3IDEwLjQgMTcgMTFWMTJIMjBDMjAuNiAxMiAyMSAxMi40IDIxIDEzVjE5QzIxIDE5LjYgMjAuNiAyMCAyMCAyMEgxM1YyMkg4VjIwSDRWMzRDMyAzLjQgMyAzIDE5LjYgMyAxOVYxM0Mz thyme:3 12.N4 3.N4 12 4 12H7V11F7 7.N4 7.N4 10 8 10H10F4Q10 2.N9 10.N9 2 12 2ZM4 20H13L13 22V20L20 20V13H21L12 12H10.N9V4V10V4H3V20ZCIvPgo8L3N2Zz4KPHRleHQgeD0iNzUiIHk9IjEzMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QnJldmFsPC90ZXh0Pgo8L3N2Zz4=", // Default placeholder SVG
            backgroundSettings: {
                url: '',
                color: '#667eea',
                opacity: 1,
                blur: 0,
                size: 'auto',
                position: 'center'
            },
            categories: [
                { id: 'family', name: 'משפחה', icon: 'fas fa-home' },
                { id: 'trips', name: 'טיולים', icon: 'fas fa-plane-departure', subcategories: [
                    { id: 'trips-abroad', name: 'טיולים בחו"ל' },
                    { id: 'trips-israel', name: 'טיולים בארץ' }
                ]},
                { id: 'events', name: 'אירועים', icon: 'fas fa-calendar-alt' },
                { id: 'childhood', name: 'ילדות', icon: 'fas fa-child' }
            ]
        };


        // Admin password (for demonstration purposes)
        const ADMIN_PASSWORD = 'admin';

        let currentFilter = 'all';
        let cropper;
        let cropTarget; // 'profile' or 'background'

        // Function to generate a unique ID
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substring(2);
        }

        // --- Master rendering function ---
        function renderAllUI() {
            renderVideos();
            loadProfilePhoto(); // Now loads from appData.profilePhoto
            loadBackgroundSettings(); // Now loads from appData.backgroundSettings
            populateCategorySelect();
            renderCategoryFilters();
        }

        // --- Video Management Functions ---
        function renderVideos() {
            const videoCategoriesContainer = document.getElementById('videoCategoriesContainer');
            videoCategoriesContainer.innerHTML = ''; // Clear existing content

            const filteredVideos = currentFilter === 'all'
                ? appData.videos
                : appData.videos.filter(video => video.category === currentFilter);

            // Group videos by category
            const videosByCategory = {};
            appData.categories.forEach(cat => {
                videosByCategory[cat.id] = filteredVideos.filter(video => video.category === cat.id);
            });

            // Render each category section
            appData.categories.forEach(cat => {
                const categoryVideos = videosByCategory[cat.id];
                if (categoryVideos.length > 0 || currentFilter === cat.id || currentFilter === 'all') { // Show category if it has videos or is the active filter
                    const categorySection = document.createElement('div');
                    categorySection.className = 'category-section';
                    categorySection.id = `category-${cat.id}`;

                    const categoryTitle = document.createElement('h2');
                    categoryTitle.className = 'category-title';
                    categoryTitle.innerHTML = `<i class="${cat.icon} category-icon"></i> ${cat.name}`;
                    categorySection.appendChild(categoryTitle);

                    const videoGallery = document.createElement('div');
                    videoGallery.className = 'video-gallery';

                    categoryVideos.forEach(video => {
                        const videoCard = document.createElement('div');
                        videoCard.className = 'video-card';
                        videoCard.dataset.id = video.id;

                        // Edit and Delete buttons (initially hidden, shown in admin mode)
                        videoCard.innerHTML = `
                            <button class="delete-btn" onclick="showConfirmModal('delete', '${video.id}')"><i class="fas fa-trash"></i></button>
                            <button class="edit-btn" onclick="editVideo('${video.id}')"><i class="fas fa-edit"></i></button>
                            <img src="${video.thumbnailUrl || 'https://placehold.co/300x180/aabbcc/ffffff?text=Video+Thumbnail'}" alt="${video.title}" class="video-thumbnail">
                            <h3 class="video-title">${video.title}</h3>
                            <p class="video-description">${video.description}</p>
                            <div class="video-actions">
                                ${video.youtubeLink ? `<a href="${video.youtubeLink}" target="_blank" class="btn btn-youtube"><i class="fab fa-youtube"></i> צפה ביוטיוב</a>` : ''}
                                ${video.tiktokLink ? `<a href="${video.tiktokLink}" target="_blank" class="btn btn-tiktok"><i class="fab fa-tiktok"></i> צפה בטיקטוק</a>` : ''}
                            </div>
                        `;
                        videoGallery.appendChild(videoCard);
                    });

                    categorySection.appendChild(videoGallery);
                    videoCategoriesContainer.appendChild(categorySection);
                }
            });

            // Re-apply admin mode display if active
            if (document.body.classList.contains('admin-mode')) {
                document.querySelectorAll('.delete-btn, .edit-btn').forEach(btn => btn.style.display = 'flex');
            } else {
                document.querySelectorAll('.delete-btn, .edit-btn').forEach(btn => btn.style.display = 'none');
            }
        }

        function addNewVideo(event) {
            event.preventDefault();

            const videoId = document.getElementById('videoId').value;
            const title = document.getElementById('videoTitle').value;
            const description = document.getElementById('videoDescription').value;
            const youtubeLink = document.getElementById('youtubeLink').value;
            const tiktokLink = document.getElementById('tiktokLink').value;
            const thumbnailUrl = document.getElementById('thumbnailUrl').value;
            const category = document.getElementById('videoCategory').value;

            if (!title || !category) {
                window.GitHubSync.showMessage('שדות חובה: כותרת וקטגוריה', 'error');
                return;
            }

            if (videoId) {
                // Editing existing video
                const videoIndex = appData.videos.findIndex(v => v.id === videoId);
                if (videoIndex > -1) {
                    appData.videos[videoIndex] = { id: videoId, title, description, youtubeLink, tiktokLink, thumbnailUrl, category };
                    window.GitHubSync.showMessage('סרטון עודכן בהצלחה!', 'success');
                }
            } else {
                // Adding new video
                const newVideo = {
                    id: generateUniqueId(),
                    title,
                    description,
                    youtubeLink,
                    tiktokLink,
                    thumbnailUrl,
                    category
                };
                appData.videos.push(newVideo);
                window.GitHubSync.showMessage('סרטון נוסף בהצלחה!', 'success');
            }

            window.GitHubSync.autoSave(); // Save entire appData object
            document.getElementById('addVideoForm').reset();
            document.getElementById('videoId').value = ''; // Clear hidden ID
            document.getElementById('addEditVideoBtn').textContent = 'הוסף סרטון'; // Reset button text
            toggleAddVideoForm(); // Hide form after submission
        }

        function editVideo(id) {
            const video = appData.videos.find(v => v.id === id);
            if (video) {
                document.getElementById('videoId').value = video.id;
                document.getElementById('videoTitle').value = video.title;
                document.getElementById('videoDescription').value = video.description;
                document.getElementById('youtubeLink').value = video.youtubeLink;
                document.getElementById('tiktokLink').value = video.tiktokLink;
                document.getElementById('thumbnailUrl').value = video.thumbnailUrl;
                document.getElementById('videoCategory').value = video.category;
                document.getElementById('addEditVideoBtn').textContent = 'שמור שינויים';
                toggleAddVideoForm(true); // Show form for editing
            }
        }

        function deleteVideo(id) {
            appData.videos = appData.videos.filter(video => video.id !== id);
            window.GitHubSync.autoSave(); // Save entire appData object
            window.GitHubSync.showMessage('סרטון נמחק בהצלחה!', 'success');
        }

        function filterVideos(category) {
            currentFilter = category;
            renderVideos();
            // Update active class for category buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // --- Admin Panel Functions ---
        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'block';
            document.getElementById('adminPassword').value = ''; // Clear password field
        }

        function authenticateAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.body.classList.add('admin-mode');
                document.getElementById('adminPanel').classList.add('active');
                closeModal('adminLoginModal');
                renderAllUI(); // Re-render to show edit/delete buttons
                window.GitHubSync.showMessage('מצב מנהל הופעל!', 'success');
            } else {
                window.GitHubSync.showMessage('סיסמה שגויה!', 'error');
            }
        }

        function exitAdmin() {
            document.body.classList.remove('admin-mode');
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('addVideoForm').classList.remove('active'); // Hide add form
            document.getElementById('backgroundSettingsForm').classList.remove('active'); // Hide background form
            renderAllUI(); // Re-render to hide edit/delete buttons
            window.GitHubSync.showMessage('מצב מנהל כבוי.', 'info');
        }

        function toggleAddVideoForm() {
            const form = document.getElementById('addVideoForm');
            form.classList.toggle('active');
            if (!form.classList.contains('active')) {
                // Reset form when closing
                document.getElementById('addVideoForm').reset();
                document.getElementById('videoId').value = '';
                document.getElementById('addEditVideoBtn').textContent = 'הוסף סרטון';
            }
        }

        function toggleDeleteMode() {
            // This function is less relevant now that edit/delete buttons are always visible in admin mode
            // but can be used to highlight deletable items or change cursor if needed.
            // For now, it just toggles the visibility of the delete buttons, which is already handled by CSS.
            window.GitHubSync.showMessage('מצב מחיקה מופעל/כבוי (כפתורים גלויים במצב מנהל).', 'info');
        }

        // --- Profile Photo & Background Management ---
        function loadProfilePhoto() {
            document.querySelector('.grandpa-photo').src = appData.profilePhoto;
        }

        function saveProfilePhoto(dataUrl) {
            appData.profilePhoto = dataUrl;
            document.querySelector('.grandpa-photo').src = dataUrl;
            window.GitHubSync.autoSave(); // Save entire appData object
        }

        function loadBackgroundSettings() {
            const settings = appData.backgroundSettings; // Get from appData
            applyBackgroundStyles(settings);
            // Populate form fields
            document.getElementById('backgroundUrl').value = settings.url;
            document.getElementById('backgroundColor').value = settings.color;
            document.getElementById('backgroundOpacity').value = settings.opacity;
            document.getElementById('backgroundBlur').value = settings.blur;
            document.querySelector(`input[name="backgroundSize"][value="${settings.size}"]`).checked = true;
            document.querySelector(`input[name="backgroundPosition"][value="${settings.position}"]`).checked = true;
        }

        function saveBackgroundSettings(settings) {
            Object.assign(appData.backgroundSettings, settings); // Update appData
            window.GitHubSync.autoSave(); // Save entire appData object
            applyBackgroundStyles(settings);
        }

        function applyBackgroundStyles(settings) {
            const body = document.body;
            body.style.backgroundImage = settings.url ? `url('${settings.url}')` : 'none';
            body.style.backgroundColor = settings.color;
            body.style.backgroundSize = settings.size;
            body.style.backgroundPosition = settings.position;
            body.style.backgroundRepeat = settings.size === 'auto' ? 'repeat' : 'no-repeat';
            body.style.backgroundAttachment = 'fixed';
            body.style.opacity = settings.opacity;
            body.style.filter = `blur(${settings.blur}px)`;
            // Reset filter for child elements to avoid blurring content
            document.querySelector('.container').style.filter = `blur(0)`;
        }

        function toggleBackgroundSettingsForm() {
            document.getElementById('backgroundSettingsForm').classList.toggle('active');
        }

        function applyBackgroundSettings() {
            const url = document.getElementById('backgroundUrl').value;
            const color = document.getElementById('backgroundColor').value;
            const opacity = parseFloat(document.getElementById('backgroundOpacity').value);
            const blur = parseInt(document.getElementById('backgroundBlur').value);
            const size = document.querySelector('input[name="backgroundSize"]:checked').value;
            const position = document.querySelector('input[name="backgroundPosition"]:checked').value;

            const settings = { url, color, opacity, blur, size, position };
            saveBackgroundSettings(settings);
            window.GitHubSync.showMessage('הגדרות רקע נשמרו!', 'success');
            toggleBackgroundSettingsForm(); // Hide form after saving
        }

        // --- Image Cropping ---
        function handleImageUpload(event, target) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageToCrop = document.getElementById('imageToCrop');
                    imageToCrop.src = e.target.result;
                    cropTarget = target;
                    openCropModal();
                };
                reader.readAsDataURL(file);
            }
        }

        function openCropModal() {
            document.getElementById('cropImageModal').style.display = 'block';
            const image = document.getElementById('imageToCrop');
            // Initialize Cropper.js after image is loaded and modal is visible
            image.onload = () => {
                if (cropper) {
                    cropper.destroy();
                }
                cropper = new Cropper(image, {
                    aspectRatio: cropTarget === 'profile' ? 1 : NaN, // 1:1 for profile, free for background
                    viewMode: 1, // Restrict the crop box to not exceed the canvas
                    autoCropArea: 0.8, // 80% of the image
                });
            };
        }

        function cropAndSaveImage() {
            if (cropper) {
                const croppedCanvas = cropper.getCroppedCanvas();
                const dataUrl = croppedCanvas.toDataURL('image/png'); // Use PNG for transparency if needed

                if (cropTarget === 'profile') {
                    saveProfilePhoto(dataUrl);
                    window.GitHubSync.showMessage('תמונת פרופיל עודכנה!', 'success');
                } else if (cropTarget === 'background') {
                    const currentSettings = { ...appData.backgroundSettings }; // Get current settings from appData
                    currentSettings.url = dataUrl;
                    saveBackgroundSettings(currentSettings);
                    window.GitHubSync.showMessage('תמונת רקע עודכנה!', 'success');
                }
                closeModal('cropImageModal');
                cropper.destroy();
                cropper = null;
            }
        }

        // --- Category Management ---
        function populateCategorySelect() {
            const selectElement = document.getElementById('videoCategory');
            selectElement.innerHTML = ''; // Clear existing options

            // Add a default "Select Category" option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'בחר קטגוריה';
            defaultOption.disabled = true;
            defaultOption.selected = true;
            selectElement.appendChild(defaultOption);

            // Add main categories
            appData.categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.id;
                option.textContent = cat.name;
                selectElement.appendChild(option);

                // Add subcategories if they exist
                if (cat.subcategories && cat.subcategories.length > 0) {
                    cat.subcategories.forEach(subCat => {
                        const subOption = document.createElement('option');
                        subOption.value = subCat.id;
                        subOption.textContent = `--- ${subCat.name}`; // Indent subcategories
                        selectElement.appendChild(subOption);
                    });
                }
            });
        }

        function renderCategoryFilters() {
            const categoryFiltersContainer = document.getElementById('categoryFilters');
            categoryFiltersContainer.innerHTML = ''; // Clear existing buttons

            // "All" button
            const allBtn = document.createElement('button');
            allBtn.className = `category-btn ${currentFilter === 'all' ? 'active' : ''}`;
            allBtn.textContent = 'הכל';
            allBtn.dataset.category = 'all';
            allBtn.onclick = () => filterVideos('all');
            categoryFiltersContainer.appendChild(allBtn);

            // Render dynamic category buttons
            appData.categories.forEach(cat => {
                const wrapper = document.createElement('div');
                wrapper.className = 'category-btn-wrapper';

                const btn = document.createElement('button');
                btn.className = `category-btn ${currentFilter === cat.id ? 'active' : ''}`;
                btn.dataset.category = cat.id;
                btn.innerHTML = `<i class="${cat.icon}"></i> ${cat.name}`;
                btn.onclick = () => {
                    // Check if it's the "טיולים" (trips) category and it has subcategories
                    if (cat.id === 'trips' && cat.subcategories && cat.subcategories.length > 0) {
                        toggleDropdown(btn);
                    } else {
                        filterVideos(cat.id);
                        closeAllDropdowns();
                    }
                };
                wrapper.appendChild(btn);

                // Add dropdown for "טיולים" if it has subcategories
                if (cat.id === 'trips' && cat.subcategories && cat.subcategories.length > 0) {
                    wrapper.classList.add('dropdown');
                    btn.classList.add('trips-btn'); // Add specific class for styling arrow

                    const dropdownContent = document.createElement('div');
                    dropdownContent.className = 'dropdown-content';
                    cat.subcategories.forEach(subCat => {
                        const subLink = document.createElement('a');
                        subLink.href = '#';
                        subLink.textContent = subCat.name;
                        subLink.onclick = (e) => {
                            e.preventDefault();
                            filterVideos(subCat.id); // Filter by subcategory ID
                            closeAllDropdowns();
                        };
                        dropdownContent.appendChild(subLink);
                    });
                    wrapper.appendChild(dropdownContent);
                }

                // Delete button for categories (only in admin mode)
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'category-delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-times-circle"></i>';
                deleteBtn.title = `מחק קטגוריה: ${cat.name}`;
                deleteBtn.onclick = (e) => {
                    e.stopPropagation(); // Prevent filter from activating
                    showConfirmModal('deleteCategory', cat.id);
                };
                wrapper.appendChild(deleteBtn);

                categoryFiltersContainer.appendChild(wrapper);
            });

            // Re-apply admin mode display if active
            if (document.body.classList.contains('admin-mode')) {
                document.querySelectorAll('.category-delete-btn').forEach(btn => btn.style.display = 'inline-block');
            } else {
                document.querySelectorAll('.category-delete-btn').forEach(btn => btn.style.display = 'none');
            }
        }

        function toggleDropdown(button) {
            const parentDropdown = button.closest('.dropdown');
            // Close other dropdowns
            document.querySelectorAll('.dropdown.show').forEach(dropdown => {
                if (dropdown !== parentDropdown) {
                    dropdown.classList.remove('show');
                }
            });
            parentDropdown.classList.toggle('show');
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown.show').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        // Close dropdowns if clicked outside
        window.onclick = function(event) {
            if (!event.target.matches('.trips-btn') && !event.target.matches('.trips-btn *')) {
                closeAllDropdowns();
            }
        };


        function openManageCategoriesModal() {
            document.getElementById('manageCategoriesModal').style.display = 'block';
            renderCategoriesInAdmin();
        }

        function renderCategoriesInAdmin() {
            const listContainer = document.getElementById('existingCategoriesList');
            listContainer.innerHTML = '';

            appData.categories.forEach(cat => {
                const categoryDiv = document.createElement('div');
                categoryDiv.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 10px;
                    border-bottom: 1px solid #eee;
                `;
                categoryDiv.innerHTML = `
                    <span><i class="${cat.icon}" style="margin-left: 10px;"></i> ${cat.name} (${cat.id})</span>
                    <button style="background: #ff4757; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer;"
                            onclick="showConfirmModal('deleteCategoryFromAdmin', '${cat.id}')">מחק</button>
                `;
                listContainer.appendChild(categoryDiv);
            });
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            const icon = document.getElementById('newCategoryIcon').value.trim();

            if (!name) {
                window.GitHubSync.showMessage('שם קטגוריה לא יכול להיות ריק.', 'error');
                return;
            }

            const id = name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, ''); // Generate ID from name

            if (appData.categories.some(cat => cat.id === id)) {
                window.GitHubSync.showMessage('קטגוריה עם שם זהה כבר קיימת.', 'error');
                return;
            }

            const newCategory = { id, name, icon };
            // Special handling for 'טיולים' (trips) to add subcategories
            if (id === 'trips' && !newCategory.subcategories) {
                newCategory.subcategories = [
                    { id: 'trips-abroad', name: 'טיולים בחו"ל' },
                    { id: 'trips-israel', name: 'טיולים בארץ' }
                ];
            }
            appData.categories.push(newCategory);
            window.GitHubSync.autoSave(); // Save entire appData object
            document.getElementById('newCategoryName').value = '';
            document.getElementById('newCategoryIcon').value = '';
            renderCategoriesInAdmin();
            window.GitHubSync.showMessage('קטגוריה נוספה בהצלחה!', 'success');
        }

        function deleteCategory(id, fromAdminModal = false) {
            // Prevent deleting if videos are linked to this category
            const videosInCat = appData.videos.filter(video => video.category === id);
            if (videosInCat.length > 0) {
                window.GitHubSync.showMessage('לא ניתן למחוק קטגוריה עם סרטונים מקושרים אליה. מחק את הסרטונים תחילה.', 'error');
                return;
            }

            appData.categories = appData.categories.filter(cat => cat.id !== id);
            window.GitHubSync.autoSave(); // Save entire appData object
            if (fromAdminModal) {
                renderCategoriesInAdmin();
                closeModal('confirmModal'); // Close confirm modal after deletion
            }
            window.GitHubSync.showMessage('קטגוריה נמחקה בהצלחה!', 'success');
        }

        // --- Modal Functions ---
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // If the confirm modal is being closed, remove it from the DOM
            if (modalId === 'confirmModal' && document.getElementById('confirmModal')) {
                document.getElementById('confirmModal').remove();
            }
        }

        // Custom confirm modal (replaces alert/confirm)
        let confirmAction = null;
        let confirmItemId = null;
        let confirmExtraParam = null;

        function showConfirmModal(action, itemId, extraParam = null) {
            confirmAction = action;
            confirmItemId = itemId;
            confirmExtraParam = extraParam;

            // Ensure only one confirm modal exists
            if (document.getElementById('confirmModal')) {
                document.getElementById('confirmModal').remove();
            }

            const modal = document.createElement('div');
            modal.id = 'confirmModal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="closeModal('confirmModal')">&times;</span>
                    <h2>אישור פעולה</h2>
                    <p id="confirmMessage" style="text-align: center; margin-bottom: 20px; font-size: 1.1rem; color: #555;"></p>
                    <div style="display: flex; justify-content: center; gap: 15px;">
                        <button class="send-btn" style="background: #dc3545;" onclick="executeConfirmAction()">אישור</button>
                        <button class="send-btn cancel-btn" style="background: #6c757d;" onclick="closeModal('confirmModal')">ביטול</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.style.display = 'block';

            let message = '';
            if (action === 'delete') {
                const videoToDelete = appData.videos.find(v => v.id === itemId);
                message = `האם אתה בטוח שברצונך למחוק את הסרטון "${videoToDelete ? videoToDelete.title : 'זה'}"?`;
            } else if (action === 'deleteCategory') {
                const categoryToDelete = appData.categories.find(c => c.id === itemId);
                message = `האם אתה בטוח שברצונך למחוק את הקטגוריה "${categoryToDelete ? categoryToDelete.name : 'זו'}"?`;
            } else if (action === 'deleteCategoryFromAdmin') {
                const categoryToDelete = appData.categories.find(c => c.id === itemId);
                message = `האם אתה בטוח שברצונך למחוק את הקטגוריה "${categoryToDelete ? categoryToDelete.name : 'זו'}"? פעולה זו בלתי הפיכה.`;
            }

            document.getElementById('confirmMessage').textContent = message;
        }

        function executeConfirmAction() {
            if (confirmAction === 'delete') {
                deleteVideo(confirmItemId);
            } else if (confirmAction === 'deleteCategory') {
                deleteCategory(confirmItemId);
            } else if (confirmAction === 'deleteCategoryFromAdmin') {
                deleteCategory(confirmItemId, true); // Pass true to indicate it's from admin modal
            }
            closeModal('confirmModal');
            confirmAction = null;
            confirmItemId = null;
            confirmExtraParam = null;
        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            window.GitHubSync.init(); // This will load all data and render the UI
        });

    </script>
</body>
</html>
